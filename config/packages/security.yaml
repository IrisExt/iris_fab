# config/packages/security.yaml
security:
    encoders:
        FOS\UserBundle\Model\UserInterface: bcrypt

    role_hierarchy:
        ROLE_ADMIN:       [ROLE_USER , ROLE_ANR , ROLE_DOS_EM, ROLE_ANR_R, ROLE_PILOTE, PILOTE_PRES, ROLE_COORD_PROJ]
        ROLE_MBRE       : ROLE_USER
        ROLE_PRES       : ROLE_USER
        ROLE_SUPER_ADMIN: ROLE_ADMIN
        ROLE_VISE_PRES  : ROLE_PRES
        ROLE_RE_SCI     : ROLE_ANR
        ROLE_GE_COSSE   : ROLE_ANR
        ROLE_RE_DEP     : ROLE_ANR
        ROLE_PILOTE     : [ROLE_ANR, ROLE_ANR_R]
        ROLE_DOS_EM     : [ROLE_ANR, ROLE_ANR_R]
        ROLE_CPS_P      : [ROLE_ANR, ROLE_CPS]
        ROLE_RE_COSSE   : [ROLE_ANR, ROLE_ANR_R]
        ROLE_CPS_S      : [ROLE_ANR, ROLE_CPS]
        ROLE_CPS        : ROLE_ANR
        ROLE_COSSE      : ROLE_ANR
        ROLE_COORD_PROJ : [ROLE_USER, ROLE_PORTEUR_PROJET]
        ROLE_PORTEUR_PROJET : [ROLE_USER, ROLE_COORD_PROJ]

    # https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers
    providers:
        fos_userbundle:
            id: fos_user.user_provider.username_email

    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            pattern:  ^/
            form_login:
                provider: fos_userbundle
                default_target_path: /fr
                login_path: fos_user_security_login
                check_path: fos_user_security_check
                csrf_token_generator: security.csrf.token_manager
                always_use_default_target_path: true
                use_forward: false
            #                remember_me: true
            #                    secret:   '%kernel.secret%'
            #                    lifetime: 604800 # 1 week in seconds
            #                    path:     /
            access_denied_handler: App\Security\AccessDeniedHandler # personaliser les messages d'acc√®s

            anonymous:    true
            logout:
                path: fos_user_security_logout
                target: /%locale%/

    # Easy way to control access for large sections of your site
    # Note: Only the *first* access control that matches will be used
    access_control:
        - { path: ^/[^/]+/login$, role: IS_AUTHENTICATED_ANONYMOUSLY }
        - { path: ^/register, role: ROLE_ADMIN }
        - { path: ^/(%app_locales%)/resetting, role: IS_AUTHENTICATED_ANONYMOUSLY }
        - { path: ^/admin/, role: ROLE_ADMIN }
        - { path: ^/(%app_locales%)/login/user, role: IS_AUTHENTICATED_ANONYMOUSLY  }
        - { path: ^/(%app_locales%)/register/, role: IS_AUTHENTICATED_ANONYMOUSLY  }
#        - { path: ^/(%app_locales%)/appel, role: ROLE_DOSEM }
        - { path: ^/(%app_locales%)/comite, role: ROLE_ANR }
        - { path: ^/(%app_locales%)/form/, role: [ROLE_DOS_EM, ROLE_USER] } # ROLE_USER , search in controller for habilitation if ROLE_PILOTE
        - { path: ^/(%app_locales%)/comite/ajout/ajouterComite, role: ROLE_PILOTE }
        - { path: ^/(%app_locales%)/constces/gstMembre/, role: [ROLE_DOS_EM, ROLE_PILOTE, ROLE_PRES, ROLE_VISE_PRES,ROLE_RE_SCI,ROLE_GE_COSSE,ROLE_RE_DEP,ROLE_CPS] }
        - { path: ^/(%app_locales%)/constces/enregisEvaluateur/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constces/enregisEvalExis/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constcesmodif/evalua/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constces/delete/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constces/ordgrp/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constces/changer/sollicit/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/constces/gstMembre/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/personne/recherche/membre/, role: [ROLE_CPS, ROLE_PRES, ROLE_VISE_PRES] }
        - { path: ^/(%app_locales%)/evaluations/, role: [ROLE_USER] }
