{% extends 'base.html.twig' %}
  {% block stylesheets1 %}
      <style>
          /* Important part */

          th {
              background-color: #369;
              color: white;
              text-align: center;
          }
      </style>
      <!-- modals CSS
          ============================================ -->
      <link rel="stylesheet" href="{{ asset('css/modals.css') }}">
      <!-- tabs CSS-->

  {% endblock %}
{% block body %}
<div class="advanced-form-area mg-b-15">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <div class="sparkline10-list shadow-reset mg-t-30">
                    <div class="sparkline10-hd">
                        <div class="main-sparkline10-hd">
                            <h1 class="text-center">Mes préférences / Modifier mon identifiant</h1>
                            <div class="sparkline10-outline-icon">

                            </div>
                        </div>
                    </div>
                    <div class="sparkline10-graph">
                        <div class="input-knob-dial-wrap">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="user-profile-post-name text-center">
                                        <h2>
                                            <a href="#" id="update_name_id" type="button"
                                               data-id="{{ path('update_name') }}"
                                               data-toggle="modal"
                                               data-target="#updateName" >{{ user.idPersonne.lbPrenom }}  {{ user.idPersonne.lbNomUsage }}
                                                <span data-toggle="tooltip" title="Modifier Nom/Prénom"
                                                      class="fa fa-edit"></span>
                                            </a>
                                        </h2>
                                        <br><br>
                                        <p><span></span>
                                        </p>
                                    </div>
                                    <div class="row">
                                        <table class="col-lg-11">
                                            <tr>
                                                <td>
                                                    <div class="col-lg-12 text-right" style="line-height:60px;">
                                                        <h4><label>Votre adresse mail actuel : </label></h4>
                                                    </div>
                                                </td>
                                                <td>
                                                    <h4>
                                                        <span style="font-size: 20px; color: #03a9f4; ">{{ user.email }}</span>
                                                    </h4>
                                                </td>
                                                <td>
                                                    <div class="col-lg-12">
                                                        {#                                                    <div class="login-social-inner">#}
                                                        <a class="button btn btn-warning"
                                                           id="change_mail"
                                                           data-id="{{ path('change_mail_update') }}"
                                                           data-toggle="modal"
                                                           data-target="#modifProfil">
                                                            <span><i class="fa fa-pencil-square-o"></i></span> Modifier
                                                        </a>
                                                        {#                                                    </div>#}
                                                    </div>
                                                </td>
                                            </tr>
                                            {% if user.identifiantDemande != null and  diffDateEnvoi < 3 %}
                                                <tr>
                                                    <td>
                                                        <div class="col-lg-12 text-right" style="line-height:80px;">
                                                            <h4><label>Adresse mail en cours de validation :</label></h4>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <h4>
                                                            <span style="color: #75758e; ">{{ user.identifiantDemande }}</span>
                                                        </h4>

                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td>
                                                        <div class="col-lg-12">
                                                            <form action="{{ path('validate_code') }}" method="post">
                                                                <div class="input-group custom-go-button">
                                                                    <input type="text" name="_codeValidate"
                                                                           class="form-control"
                                                                           required>
                                                                    <span class="input-group-btn">
                                                                        <button type="submit" class="btn btn-primary">
                                                                            ACTIVER !
                                                                        </button>
                                                                    </span>
                                                                </div>
                                                                <small> Code d'activation reçu par mail</small><br>
                                                                <small style="color: red"><b>Attention :</b> Vous serez
                                                                    déconnecté
                                                                    après activation du nouvel identifiant.<br>
                                                                    La session d'activation expire dans {{ 72 - heure }} h.
                                                                </small>
                                                                <input type="hidden" name="_token"
                                                                       value="{{ csrf_token('change' ~  user.idPersonne ) }}">
                                                            </form>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        </table>
                                        <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-8 col-lg-offset-2">
                <div class="sparkline10-list shadow-reset mg-t-30">
                    <div class="sparkline10-hd">
                        <div class="main-sparkline10-hd">
                            <h1 class="text-center">Modifier mon mot de passe</h1>
                            <div class="sparkline10-outline-icon">
                            </div>
                        </div>
                    </div>
                    <div class="sparkline10-graph">
                        <div class="row">
                            <div class="col-lg-8 col-lg-offset-2">
                                <div class="panel-heading">
                                    <h4 class="panel-title"
                                        data-toggle="collapse"
                                        data-target="#password">
                                        <a href="#">Modifier mon mot de passe</a>
                                    </h4>
                                </div>
                                <div id="password" class="panel-collapse  collapse in">
                                    <div class="panel-body">
                                        <div class="card-body">
                                            {{ form_start(form, { 'action': path('mon_profil'), 'attr': { 'class': 'fos_user_change_password' } }) }}

                                            {{ form_widget(form) }}
                                            <div class="form-group row">
                                                <div class="col-md-4 col-md-offset-7">
                                                    <input class="btn btn-warning" type="submit"
                                                           value="Modifier le mot de passe"/>
                                                </div>
                                            </div>
                                            {{ form_end(form) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mail perso -->
            {#        <div class="col-lg-8 col-lg-offset-2">#}
            {#            <div class="sparkline12-list shadow-reset mg-t-30">#}
            {#                <div class="sparkline12-hd">#}
            {#                    <div class="main-sparkline12-hd">#}
            {#                        <h1 class="text-center">Gérer mes mails Personnels</h1>#}
            {#                        <div class="sparkline10-outline-icon">#}
            {#                            <span class="sparkline12-collapse-link"><i class="fa fa-chevron-up"></i></span>#}
            {#                        </div>#}
            {#                    </div>#}
            {#                </div>#}
            {#                <div class="sparkline12-graph">#}
            {#                    <div class="row">#}
            {#                        <div class="col-lg-8 col-lg-offset-2">#}
            {#                            <div class="text-right">#}
            {#                                <a href="#" id="add_mail" type="button" data-id="{{ path('add_mail') }}" data-toggle="modal" data-target="#gererMail"#}
            {#                                   class="btn btn-primary btn-xs"><i class="fa fa-plus"></i>#}
            {#                                    Ajouter#}
            {#                                </a>#}
            {#                            </div>#}
            {#                            <div class="table-responsive">#}
            {#                                <table class="table table-striped table-bordered" id="user_data">#}
            {#                                    <tr>#}
            {#                                        <th colspan="col">Adresse mail personnel</th>#}
            {#                                        <th colspan="col">Notification</th>#}
            {#                                        <th colspan="col">Action</th>#}
            {#                                    </tr>#}
            {#                                    <tbody>#}
            {#                                    {% for mail in mails %}#}
            {#                                        {% if mail != user.email %}#}
            {#                                            <tr>#}
            {#                                                <td>{{ mail.adrMail }}</td>#}
            {#                                                #}{#                                        <td>{{ mail.blValide ?'Oui' : 'Non' }}</td>#}
            {#                                                #}{#                                        <td>{{ mail.blNotification ?'Oui' : 'Non' }}</td>#}
            {#                                                <td><a href="#" id="update_mail" data-toggle="modal" data-target="#updateMail" data-id="{{ path('update_mail', {'adrmail' : mail.adrMail}) }}"><span#}
            {#                                                                class="fa fa-edit"></span></a> |#}
            {#                                                    <a href="#" id="delete_Mail" data-toggle="modal" data-target="#deleteLangue" data-id="{{ path('delete_mail', {'adrmail' : mail.adrMail}) }}"><span#}
            {#                                                                class="fa fa-trash-o text-danger"></span></a></td>#}
            {#                                            </tr>#}
            {#                                        {% endif %}#}
            {#                                    {% endfor %}#}
            {#                                    </tbody>#}
            {#                                </table>#}
            {#                            </div>#}
            {#                        </div>#}
            {#                    </div>#}
            {#                </div>#}
            {#            </div>#}
            {#        </div>#}
            <!-- mail notif -->
            <div class="col-lg-8 col-lg-offset-2">
                <div class="sparkline13-list shadow-reset mg-t-30">
                    <div class="sparkline13-hd">
                        <div class="main-sparkline13-hd">
                            <h1 class="text-center">Gérer mes mails de notification</h1>
                            <div class="sparkline10-outline-icon">
                                <span class="sparkline13-collapse-link"><i class="fa fa-chevron-up"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="sparkline13-graph">
                        <div class="row">
                            <div class="col-lg-8 col-lg-offset-2">
                                <div class="text-right">
                                    <a href="#" id="add_mail_notif" type="button" data-toggle="modal"
                                       data-target="#addMailNotif" data-id="{{ path('add_mail_notif') }}"
                                       class="btn btn-primary btn-xs"><i class="fa fa-plus"></i>
                                        Ajouter
                                    </a>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered" id="user_data">
                                        <tr>
                                            <th colspan="col">Adresse mail de notification</th>
                                            <th colspan="col">Obsolète</th>
                                            <th colspan="col">Action</th>
                                        </tr>
                                        <tbody>
                                        {% for mailNotif in mailNotifs %}
                                            {% if mailNotif != user.email %}
                                                <tr>
                                                    <td>{{ mailNotif }}</td>
                                                    <td class="text-center">{{ mailNotif.blObsolete ? 'Oui' : 'Non' }}</td>
                                                    <td>
                                                        <a href="#" id="update_mail_notif" data-toggle="modal"
                                                           data-target="#updateMailNotif"
                                                           data-id="{{ path('update_mail_notif', {'mailNotification' : mailNotif}) }}"><span
                                                                    data-toggle="tooltip" title="Modifier"
                                                                    class="fa fa-edit"></span></a> |
                                                        <a href="#" id="delete_Mail_notif" data-toggle="modal"
                                                           data-target="#deleteLangue"
                                                           data-id="{{ path('delete_mail_notif', {'mailNotification' : mailNotif}) }}"><span
                                                                    data-toggle="tooltip" title="Supprimer"
                                                                    class="fa fa-trash-o text-danger"></span></a>
                                                    </td>
                                                </tr>
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- Modal change mail      -->   {% include 'profil/modal/change_mail.html.twig' %}
    <!-- Modal update nom      -->   {% include 'profil/modal/update_name.html.twig' %}
    <!-- Modal ajout mail notif-->   {% include 'profil/modal/add_mail_notif.html.twig' %}
    <!-- Modal update mail notif-->  {% include 'profil/modal/update_mail_notif.html.twig' %}

    <!-- Modal ajout mail perso-->   {% include 'profil/modal/add_mail.html.twig' %}
    <!-- Modal update mail notif-->  {% include 'profil/modal/update_mail.html.twig' %}

    <!-- Modal delete-->   {% include 'cvPersonne/blocs/tg_competence_langue/deleteLangue.html.twig' %}




{% endblock %}
{% block javascripts1 %}
    <!-- icheck JS
           ============================================ -->
    <script src="{{ asset('/js/icheck/icheck.min.js') }}"></script>
    <script src="{{ asset('/js/icheck/icheck-active.js') }}"></script>
    <script>

        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        $(document).on("click", "#change_mail", function () {
            var path = $(this).data('id');
            // AJAX request
            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#modifProfil').modal('show');

                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#add_mail", function () {
            var path = $(this).data('id');
            // AJAX request
            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#gererMail').modal('show');

                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#update_mail", function () {
            var path = $(this).data('id');
            // AJAX request

            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#updateMail').modal('show');

                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#add_mail_notif", function () {
            var path = $(this).data('id');
            // AJAX request
            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#addMailNotif').modal('show');

                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#update_mail_notif", function () {
            var path = $(this).data('id');
            // AJAX request

            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#updateMailNotif').modal('show');

                    $('.i-checks').iCheck({
                        checkboxClass: 'icheckbox_square-green',
                        radioClass: 'iradio_square-green',
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#delete_Mail", function () {
            var path = $(this).data('id');
            // AJAX request
            $.ajax({
                url: path,
                type: 'delete',
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#deleteLangue').modal('show');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

        $(document).on("click", "#delete_Mail_notif", function () {
            var path = $(this).data('id');

            // AJAX request
            $.ajax({
                url: path,
                type: 'delete',
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#deleteLangue').modal('show');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });
        $(document).on("click", "#update_name_id", function () {
            var path = $(this).data('id');
            // AJAX request
            $.ajax({
                url: path,
                success: function (response) {
                    // Add response in Modal body
                    $('.modal-body').html(response);
                    // Display Modal
                    $('#updateName').modal('show');
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('Error : ' + errorThrown);
                }
            });
        });

    </script>
{% endblock %}