{% trans_default_domain 'Evaluations' %}
<div class="row">
  {{ include('evaluation/evaluation/modal/contact_personne.html.twig', {personne: tgPersonne}) }}
</div></br></br>
<div class="row">
  
  <div class="col-md-6">
    <h4 class="modal-title">Post-it </a></h4>
  </div>
  <div class="col-md-6">
    <h4 class="modal-title"><a href="#" id="show_edit_comment" class="footer-text-right" type="button"  data-toggle="modal" data-target="#evaluationModal"
                                                data-id="{{ path('update_name') }}"><span class="adminpro-icon adminpro-edit"></span></a></h4>
  </div>
</div></br></br>
<div class="row">
  <div class="row">
      <div id="comments" class="col-md-10">
        {% for comment in personneComments %}
          <p>{{ comment.idPersonne.lbNomUsage ~ " " ~ comment.idPersonne.lbPrenom }}:</p>
          <p>{{ comment.dhCommande| date('d/m/Y') }} à {{ comment.dhCommande| date('H:i') }}</p>
          <p>{{ comment.txtCommentaire }}</p>
          <hr>
        {% endfor %}
      </div>
  </div>
</div>

{% block javascripts %}
    <script>
        $("#show_edit_comment").on("click", function () {

          var bodyhtml =
              "<div class='row add_comment'>"+
                "<div class='row'>"+
                  "<div class='col-md-12'>"+
                    "<textarea id='add_comment' name='add_comment' rows='5' cols='70'></textarea>"+
                  "</div>"+
                "</div>"+
                "<div class='row'>"+
                  "<div class='col-md-12'>"+
                      "<button type='submit' class='btn btn-warning send-comment' data-id={{ path('set_ajax_comment') }} data-idprojet='{{ project.idProjet }}' data-idpersonne='{{ tgPersonne.idPersonne }}'>Soumettre</button>"+
                  "</div>"+
                "</div><br>"+
              "</div>";
            $('#evaluationModal .modal-title').text('Ajouter un Commentaire');
            $('#evaluationModal .modal-body').html(bodyhtml);
            // AJAX request
            $('.send-comment').on("click", function (event ) {
              $('#comments').html("<div id='loader'></div>");
              $.ajax({
                  url: $(this).data('id'),
                  type: 'POST',
                  data: 'idPersonne='+ $(this).data('idpersonne')+'&idProjet='+ $(this).data('idprojet')+'&comment='+ $('textarea#add_comment').val(),
                  success: function (response) {
                    if (response.success) {
                      $('textarea#add_comment').val('');
                      $('.close').trigger("click");
                      var html = '';
                      response.comments.forEach(function(comment) {
                          html += "<p>"+comment.lbNomUsage+' '+comment.lbPrenom+' :</p>'+
                          '<p>'+comment.dhCommandeDay+ ' à '+comment.dhCommandeTime+ '</p>'+
                          '<p>'+comment.txtCommentaire+'</p><hr>';
                      });

                      $('#comments').html(html);
                    }
                  },
                  error: function (XMLHttpRequest, textStatus, errorThrown) {
                      alert('Error : ' + errorThrown);
                  }
              });
            });
        });
    </script>
{% endblock %}

